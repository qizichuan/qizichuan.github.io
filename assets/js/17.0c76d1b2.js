(window.webpackJsonp=window.webpackJsonp||[]).push([[17],{494:function(s,a,e){s.exports=e.p+"assets/img/1670808569999.25ac6b44.png"},495:function(s,a,e){s.exports=e.p+"assets/img/1670810468571.5cdfe9cf.png"},496:function(s,a,e){s.exports=e.p+"assets/img/1670811298597.6688e35e.png"},497:function(s,a,e){s.exports=e.p+"assets/img/1670811559327.f2a89244.png"},600:function(s,a,e){"use strict";e.r(a);var t=e(2),n=Object(t.a)({},(function(){var s=this,a=s._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[s._v("介绍")]),s._v(" "),a("p",[s._v("基于docker安装Elasticsearch搜索引擎+Head+Kibana+ik分词器")])]),s._v(" "),a("h2",{attrs:{id:"介绍"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#介绍"}},[s._v("#")]),s._v(" 介绍")]),s._v(" "),a("p",[s._v("Elasticsearch 是一个分布式、高扩展、高实时的搜索与数据分析引擎。\nElasticsearch 的实现原理主要分为以下几个步骤，首先用户将数据提交到Elasticsearch 数据库中，再通过分词控制器去将对应的语句分词，将其权重和分词结果一并存入数据，当用户搜索数据时候，再根据权重将结果排名，打分，再将返回结果呈现给用户。\nElasticsearch是基于Lucence的一款分布式实时搜索引擎。\nElasticsearch 通俗来说，就是一个搜索引擎，比如大家都用的百度搜索。")]),s._v(" "),a("h2",{attrs:{id:"环境"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#环境"}},[s._v("#")]),s._v(" 环境")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("最少要求2核2G")])]),s._v(" "),a("li",[a("p",[s._v("本篇安装环境为Ubuntu20.04 LTS")])]),s._v(" "),a("li",[a("p",[s._v("提示：安装的版本需要对应elasticsearch，不然无法使用")])])]),s._v(" "),a("h2",{attrs:{id:"docker拉取镜像"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#docker拉取镜像"}},[s._v("#")]),s._v(" docker拉取镜像")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 拉取 ElasticSearch镜像")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" pull elasticsearch:7.6.1\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 拉取 Head 镜像")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" pull mobz/elasticsearch-head:5\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 拉取 Kibana 镜像")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" pull kibana:7.6.1\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("h2",{attrs:{id:"启动容器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#启动容器"}},[s._v("#")]),s._v(" 启动容器")]),s._v(" "),a("h3",{attrs:{id:"启动es容器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#启动es容器"}},[s._v("#")]),s._v(" 启动es容器")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# -e "discovery.type=single-node"  单节点集群')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# -e ES_JAVA_OPTS="-Xms512m -Xmx512m"  制定运行参数，不然如果机器内存太小，启动后会非常卡顿')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# --name 起个别名")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9200")]),s._v(":9200 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9300")]),s._v(":9300 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--name")]),s._v(" elasticsearch "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-e")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"discovery.type=single-node"')]),s._v("  "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-e")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ES_JAVA_OPTS")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-Xms512m -Xmx512m"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-d")]),s._v(" elasticsearch:7.6.1\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("h3",{attrs:{id:"启动head容器-es-客户端"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#启动head容器-es-客户端"}},[s._v("#")]),s._v(" 启动head容器(es 客户端 )")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-d")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9100")]),s._v(":9100 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--name")]),s._v(" es_head docker.io/mobz/elasticsearch-head:5\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("启动成功后，浏览器访问 http://ip:9100 "),a("font",{staticStyle:{color:"red"}},[s._v("注意：需要放开防火墙和安全组")])],1),s._v(" "),a("p",[a("img",{attrs:{src:e(494),alt:"1670808569999"}})]),s._v(" "),a("p",[s._v("如果有跨域，或者其他问题，修改一下文件")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 进入容器")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-it")]),s._v(" elasticsearch /bin/bash\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 进入config目录")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" ./config\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 编辑 elasticsearch.yml 文件")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("vi")]),s._v(" elasticsearch.yml\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("p",[s._v("在elasticsearch.yml中末尾添加以下内容")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("network.host: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0\nhttp.cors.enabled: "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\nhttp.cors.allow-origin: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"*"')]),s._v("\nhttp.cors.allow-methods: OPTIONS, HEAD, GET, POST, PUT, DELETE\nhttp.cors.allow-headers: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"X-Requested-With, Content-Type, Content-Length, X-User"')]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("p",[s._v("重启elasticsearch容器")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" restart elasticsearch\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h3",{attrs:{id:"启动-kibana"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#启动-kibana"}},[s._v("#")]),s._v(" 启动 Kibana")]),s._v(" "),a("p",[s._v("Kibana 是一个开发工具，相同的还有postman、apipost等")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-d")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5601")]),s._v(":5601 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--name")]),s._v(" kibana "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--link")]),s._v(" elasticsearch:elasticsearch kibana:7.6.1\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("浏览器访问 http://ip:5601/Kibana 默认是英文的， kibana 7.X已经为我们准备好了汉化选项 。")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 进入容器")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-it")]),s._v(" kibana /bin/bash\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 进入config目录")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" config\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 编辑 kibana.yml 文件")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("vi")]),s._v(" kibana.yml\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("p",[s._v("在 kibana.yml末尾追加")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("i18n.locale: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"zh-CN"')]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("重启kibana容器")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" restart kibana\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("浏览器访问 http://ip:5601/ ，看到如下界面")]),s._v(" "),a("p",[a("img",{attrs:{src:e(495),alt:"1670810468571"}})]),s._v(" "),a("p",[a("img",{attrs:{src:e(496),alt:"1670811298597"}})]),s._v(" "),a("h2",{attrs:{id:"head报错修改"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#head报错修改"}},[s._v("#")]),s._v(" head报错修改")]),s._v(" "),a("p",[s._v("通过 Kibana 插入数据后，在head的数据预览页面发现数据没有加载出来，打开检查，发现前端报错406。")]),s._v(" "),a("p",[a("img",{attrs:{src:e(497),alt:"1670811559327"}})]),s._v(" "),a("p",[s._v("解决方案：")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 进入head容器中")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-it")]),s._v(" es_head /bin/bash\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" _site\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 先安装vim")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt-get")]),s._v(" update\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt-get")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" vendor.js\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#输入 :6886 #代表，跳转到6886行")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v('#将contentType: "application/x-www-form-urlencoded" 修改为contentType:"application/json;charset=UTF-8"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#输入 :7573 #代表，跳转到7573行")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v('#将var inspectData = s.contentType === "application/x-www-form-urlencoded" && 修改为 var inspectData = s.contentType === "application/json;charset=UTF-8" &&')]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br")])]),a("p",[s._v("保存退出，不需要重启容器")]),s._v(" "),a("h2",{attrs:{id:"安装ik分词插件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安装ik分词插件"}},[s._v("#")]),s._v(" 安装ik分词插件")]),s._v(" "),a("p",[s._v("百度网盘链接：https://pan.baidu.com/s/1gAQfwBsPDB2FeSMKPn4HNQ?pwd=7a9m\n提取码：7a9m")]),s._v(" "),a("p",[s._v("上传到你的服务器，cp到elasticsearch容器即可。")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" elasticsearch-analysis-ik-7.6.1.zip elasticsearch:/usr/share/elasticsearch/plugins\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 进入容器内部")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-it")]),s._v(" elasticsearch /bin/bash\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 创建ik目录，移动")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" /usr/share/elasticsearch/plugins/ik\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mv")]),s._v(" /usr/share/elasticsearch/plugins/elasticsearch-analysis-ik-7.6.1.zip /usr/share/elasticsearch/plugins/ik\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /usr/share/elasticsearch/plugins/ik\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 解压")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("unzip")]),s._v(" elasticsearch-analysis-ik-7.6.1.zip\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ok了，退出，重启")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exit")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" restart elasticsearch\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br")])]),a("h2",{attrs:{id:"课程"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#课程"}},[s._v("#")]),s._v(" 课程")]),s._v(" "),a("p",[s._v("b站狂神，讲解es视频"),a("a",{attrs:{href:"https://www.bilibili.com/video/BV17a4y1x7zq/",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://www.bilibili.com/video/BV17a4y1x7zq/"),a("OutboundLink")],1)]),s._v(" "),a("p",[s._v("关于我为什么学es呢，哈哈，期末考试，学习通，为了不挂科，可以参考另一篇博客，学习通自动搜索题考试。")])])}),[],!1,null,null,null);a.default=n.exports}}]);