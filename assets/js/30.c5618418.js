(window.webpackJsonp=window.webpackJsonp||[]).push([[30],{598:function(s,a,e){"use strict";e.r(a);var t=e(2),n=Object(t.a)({},(function(){var s=this,a=s._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("div",{staticClass:"custom-block warning"},[a("p",{staticClass:"custom-block-title"},[s._v("介绍")]),s._v(" "),a("p",[s._v("服务器总是被攻击怎么办，如何屏蔽国外网址，防火墙的基本命令使用")])]),s._v(" "),a("h3",{attrs:{id:"服务器总是被攻击怎么办"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#服务器总是被攻击怎么办"}},[s._v("#")]),s._v(" 服务器总是被攻击怎么办")]),s._v(" "),a("h2",{attrs:{id:"_1-防火墙"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-防火墙"}},[s._v("#")]),s._v(" 1.防火墙")]),s._v(" "),a("h5",{attrs:{id:"检查防火墙端口-在windows的cmd窗口输入"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#检查防火墙端口-在windows的cmd窗口输入"}},[s._v("#")]),s._v(" 检查防火墙端口，在windows的cmd窗口输入")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("telnet ip地址 端口\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("如果提示")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("telnet不是内部或外部命令\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("如果提示 “无法打开到主机的连接。 在端口 1863: 连接失败” 就代表端口未放行")]),s._v(" "),a("h4",{attrs:{id:"防火墙命令"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#防火墙命令"}},[s._v("#")]),s._v(" 防火墙命令")]),s._v(" "),a("h3",{attrs:{id:"_1-查看防火墙状态"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-查看防火墙状态"}},[s._v("#")]),s._v(" 1.查看防火墙状态")]),s._v(" "),a("div",{staticClass:"language-text line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("systemctl status firewalld.service\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("Active:active(running)表示已开启防火墙")]),s._v(" "),a("h3",{attrs:{id:"_2-开启防火墙"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-开启防火墙"}},[s._v("#")]),s._v(" 2. 开启防火墙")]),s._v(" "),a("div",{staticClass:"language-text line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("systemctl start firewalld.service\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h3",{attrs:{id:"_3-关闭防火墙"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-关闭防火墙"}},[s._v("#")]),s._v(" 3.关闭防火墙")]),s._v(" "),a("div",{staticClass:"language-text line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("systemctl stop firewalld.service\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h3",{attrs:{id:"_4-禁用防火墙"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-禁用防火墙"}},[s._v("#")]),s._v(" 4. 禁用防火墙")]),s._v(" "),a("div",{staticClass:"language-text line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("systemctl disable firewalld.service\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h3",{attrs:{id:"_5-查看防火墙已开放端口列表"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-查看防火墙已开放端口列表"}},[s._v("#")]),s._v(" 5.查看防火墙已开放端口列表")]),s._v(" "),a("div",{staticClass:"language-text line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("firewall-cmd --list-all\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("如下：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("[root@qi ~]# firewall-cmd --list-all\npublic\n  target: default\n  icmp-block-inversion: no\n  interfaces: \n  sources: \n  services: dhcpv6-client ssh\n  ports: 5001/tcp 80/tcp //这里便是5001和80端口开放\n  protocols: \n  masquerade: no\n  forward-ports: \n  source-ports: \n  icmp-blocks: \n  rich rules: \n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br")])]),a("h3",{attrs:{id:"_6-防火墙添加端口"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_6-防火墙添加端口"}},[s._v("#")]),s._v(" 6.防火墙添加端口")]),s._v(" "),a("div",{staticClass:"language-text line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("firewall-cmd --permanent --add-port=3306/tcp\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("提示success表示添加成功，再更新防火墙配置")]),s._v(" "),a("div",{staticClass:"language-text line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("firewall-cmd --reload\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h3",{attrs:{id:"_7-防火墙关闭端口"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_7-防火墙关闭端口"}},[s._v("#")]),s._v(" 7.防火墙关闭端口")]),s._v(" "),a("div",{staticClass:"language-text line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("firewall-cmd --permanent --remove-port 3306/tcp\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("提示success表示添加成功，再更新防火墙配置")]),s._v(" "),a("div",{staticClass:"language-text line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("firewall-cmd --reload\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[a("font",{attrs:{color:"red"}},[s._v("如果你设置了防火墙无法并开启了端口，仍然无法访问，则需要到阿里云服务器控制台查看是否设置了安全组规则")])],1),s._v(" "),a("h2",{attrs:{id:"_2-禁止国外ip访问"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-禁止国外ip访问"}},[s._v("#")]),s._v(" 2.禁止国外ip访问")]),s._v(" "),a("p",[s._v("默认保存路径/root/china_ip.txt")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("wget -q --timeout=60 -O- 'http://ftp.apnic.net/apnic/stats/apnic/delegated-apnic-latest' | awk -F\\| '/CN\\|ipv4/ { printf(\"%s/%d\\n\", $4, 32-log($5)/log(2)) }' > /root/china_ip.txt\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("进入/root目录，新建allcn.sh")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("cd /root\nvim allcn.sh\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("在allcn.sh中粘贴以下内容")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('mmode=$1\nCNIP="/root/china_ip.txt"\ngen_iplist() {\n        cat <<-EOF\n                $(cat ${CNIP:=/dev/null} 2>/dev/null)\nEOF\n}\n\nflush_r() {\niptables  -F ALLCNRULE 2>/dev/null\niptables -D INPUT -p tcp -j ALLCNRULE 2>/dev/null\niptables  -X ALLCNRULE 2>/dev/null\nipset -X allcn 2>/dev/null\n}\n\nmstart() {\nipset create allcn hash:net 2>/dev/null\nipset -! -R <<-EOF \n$(gen_iplist | sed -e "s/^/add allcn /")\nEOF\n\niptables -N ALLCNRULE \niptables -I INPUT -p tcp -j ALLCNRULE \niptables -A ALLCNRULE -s 127.0.0.0/8 -j RETURN\niptables -A ALLCNRULE -s 169.254.0.0/16 -j RETURN\niptables -A ALLCNRULE -s 224.0.0.0/4 -j RETURN\niptables -A ALLCNRULE -s 255.255.255.255 -j RETURN\niptables -A ALLCNRULE -m set --match-set allcn  src -j RETURN \niptables -A ALLCNRULE -p tcp -j DROP \n}\n\nif [ "$mmode" == "stop" ] ;then\nflush_r\nexit 0\nfi\n\nflush_r\nsleep 1\nmstart\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br")])]),a("p",[s._v("保存后，执行")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("sh allcn.sh\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("如果有一天你不再需要禁止国外ip访问，执行")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("sh allcn.sh stop\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])])])}),[],!1,null,null,null);a.default=n.exports}}]);